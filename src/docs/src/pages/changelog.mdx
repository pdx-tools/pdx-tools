# Changelog

import React from 'react';
import EditThisPage from '@theme/EditThisPage';
import { usePluginData } from '@docusaurus/useGlobalData';

See a typo, grammar issue, or inaccuracy? <EditThisPage editUrl="https://github.com/pdx-tools/pdx-tools/edit/master/src/docs/src/pages/changelog.mdx" />

export default function ChangelogPage() {
  const pluginData = usePluginData('pdx-updates-plugin') || {};
  const releases = pluginData.releases || [];
  const sectionOrder = [
    { key: 'improvements', label: '✨' },
    { key: 'fixes', label: '🐛' },
  ];

  const emojiMap = Object.fromEntries(
    sectionOrder.map(({ key, label }) => [key, label]),
  );

  return (
    <div className="changelog-layout">
      <nav aria-label="Release shortcuts" className="changelog-nav">
        <h2>Releases</h2>
        <ol>
          {releases.map((release) => (
            <li key={`nav-${release.release_date}`}>
              <a href={`#${release.release_date}`}>{release.release_date}</a>
            </li>
          ))}
        </ol>
      </nav>

      <div className="changelog-content">
        {releases.map((release) => {
          const sections = release.sections || {};
          return (
            <section
              key={release.release_date}
              id={release.release_date}
              className="release"
            >
              <h2>{release.release_date}</h2>
              {release.headline ? (
                <p>
                  <strong>{release.headline}</strong>
                </p>
              ) : null}
              {release.summary && release.summary !== release.headline ? (
                <p>{release.summary}</p>
              ) : null}

              {sectionOrder.map(({ key }) => {
                const items = sections[key] || [];
                if (!items.length) {
                  return null;
                }
                const emoji = emojiMap[key] || "";
                return (
                  <ul key={key} className="changelog-entries">
                    {items.map((item, index) => (
                      <li key={`${release.release_date}-${key}-${index}`}>
                        <span className="changelog-emoji">{emoji}</span>
                        {item}
                      </li>
                    ))}
                  </ul>
                );
              })}

              {release.learn_more_url ? (
                <p>
                  <a href={release.learn_more_url}>Learn more</a>
                </p>
              ) : null}

              {release.cta && release.cta.label && release.cta.url ? (
                <p>
                  <a href={release.cta.url}>{release.cta.label}</a>
                </p>
              ) : null}
            </section>
          );
        })}
      </div>
    </div>
  );
}
